<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>YouTube Multi-Frame Player</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f0f0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 { font-size: 1.5rem; text-align: center; padding: 10px; }
  #inputArea {
    width: 95%; max-width: 600px;
    display: flex; flex-direction: column;
    gap: 8px;
    margin-bottom: 15px;
  }
  textarea {
    width: 100%;
    min-height: 100px;
    padding: 8px;
    font-size: 14px;
  }
  button {
    padding: 10px; font-size: 14px;
    background: #cc0000; color: white;
    border: none; cursor: pointer;
    border-radius: 5px;
  }
  button:hover { background: #e60000; }
  #playerGrid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    width: 100%;
    max-width: 1000px;
    padding: 10px;
  }
  iframe {
    width: 100%; aspect-ratio: 16/9;
    background: black;
  }
</style>
</head>
<body>

<h1>Hack Watc Time by Heryana</h1>

<div id="inputArea">
  <textarea id="urls" placeholder="Masukkan maksimal 10 URL YouTube, satu per baris"></textarea>
  <button onclick="startPlayers()">Putar Video</button>
</div>

<div id="playerGrid"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
  let players = [];
  let urls = [];
  let currentIndex = 0;
  let playingCount = 0;
  let maxSimultaneous = 3; // 2-3 random
  let playingIndices = [];

  function onYouTubeIframeAPIReady() {
    console.log("YouTube API Ready");
  }

  function startPlayers() {
    // Ambil URL dan filter max 10
    urls = document.getElementById("urls").value
      .split("\n")
      .map(u => u.trim())
      .filter(u => u.length > 0)
      .slice(0, 10);

    if (urls.length === 0) {
      alert("Masukkan minimal 1 URL YouTube.");
      return;
    }

    document.getElementById("playerGrid").innerHTML = "";
    players = [];
    currentIndex = 0;
    playingIndices = [];

    // Acak jumlah simultaneous play antara 2 dan 3
    maxSimultaneous = Math.floor(Math.random() * 2) + 2;

    // Buat player kosong
    urls.forEach((url, i) => {
      let div = document.createElement("div");
      div.id = "player" + i;
      document.getElementById("playerGrid").appendChild(div);

      let videoId = extractVideoId(url);
      if (videoId) {
        players[i] = new YT.Player(div.id, {
          height: '180',
          width: '320',
          videoId: videoId,
          playerVars: {
            modestbranding: 1,
            rel: 0,
            playsinline: 1,
            mute: 1
          },
          events: {
            'onStateChange': onPlayerStateChange
          }
        });
      }
    });

    // Mulai putar batch pertama
    setTimeout(playNextBatch, 1000);
  }

  function extractVideoId(url) {
    let match = url.match(/(?:v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/);
    return match ? match[1] : null;
  }

  function playNextBatch() {
    // Pause semua player dulu
    players.forEach(p => { if (p && p.pauseVideo) p.pauseVideo(); });

    playingIndices = [];
    playingCount = 0;

    let batchSize = Math.floor(Math.random() * 2) + 2; // 2-3 video
    for (let i = 0; i < batchSize && currentIndex < urls.length; i++) {
      if (players[currentIndex]) {
        players[currentIndex].playVideo();
        playingIndices.push(currentIndex);
        playingCount++;
        currentIndex++;
      }
    }
  }

  function onPlayerStateChange(event) {
    // 0 = ended
    if (event.data === YT.PlayerState.ENDED) {
      let index = players.indexOf(event.target);
      playingCount--;

      // Jika semua video dalam batch selesai, lanjut batch berikutnya
      if (playingCount <= 0) {
        if (currentIndex < urls.length) {
          playNextBatch();
        } else {
          // Semua selesai
          document.getElementById("playerGrid").innerHTML = "";
        }
      }
    }
  }
</script>

</body>
</html>
